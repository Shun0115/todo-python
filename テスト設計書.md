# 📝 テスト設計書（食事＆筋トレAIアシスタント）

## 1. テスト目的
ユーザーが入力したデータをもとに、AI（Ollama）が食事・筋トレプランを生成し、SQLiteに保存し、Web画面で正しく表示できることを確認する。  
異常系入力やAPI失敗時に正しくエラーハンドリングされることを保証する。  

---

## 2. テスト対象
- アプリケーション：Flask Webアプリ  
- モジュール：  
  - ユーザー入力フォーム（index.html）  
  - プラン生成機能（generate_plan関数 + Ollama API）  
  - DB保存処理（users, plansテーブル）  
  - 履歴表示画面（history.html）  

---

## 3. テスト観点
1. 入力検証（数値、未入力、不正値）  
2. API連携（正常応答、失敗時の挙動）  
3. DB保存・取得（users, plansの整合性、履歴制御）  
4. UI表示（フォーム、結果画面、履歴画面の確認）  

---

## 4. テスト環境
- OS: Windows 11  
- Python: 3.12.10
- Flask: 3.1.2 
- SQLite: 3.50.4
- ブラウザ: Edge
- Ollama サーバー（http://127.0.0.1:11435）起動済み  

---

## 5. テストケース一覧

| テストID | テスト項目 | 入力データ | 期待結果 | 観点 |
|----------|------------|------------|----------|------|
| T-001 | 正常入力でプラン生成 | weight=45, body_fat=20, goal=18 | AIプランが生成され result.html に表示 | 正常系 |
| T-002 | 未入力送信 | 空欄 | 入力エラーが表示され処理されない | 異常系 |
| T-003 | 数値以外の入力 | weight="abc" | エラーメッセージ表示 or 入力画面に戻る | 異常系 |
| T-004 | 境界値入力 | weight=300, body_fat=1, goal=5 | DBに保存され履歴表示される | 境界値 |
| T-005 | APIタイムアウト | 正常値入力、Ollama停止中 | 「[エラー] Ollama API失敗…」と表示 | APIエラー |
| T-006 | DB保存確認 | 正常入力後にhistoryを表示 | users/plansに保存され履歴に表示 | DB |
| T-007 | 履歴が5件未満 | 1回入力 | 1件だけ履歴表示 | UI |
| T-008 | 履歴が6件以上 | 6回入力 | 新しい5件のみ表示 | UI |
| T-009 | 同一入力を複数回保存 | 60,20,15 を3回入力 | DBに3件保存され履歴表示 | DB |
| T-010 | 履歴画面表示確認 | 正常データあり | 体重・体脂肪率・目標・日時が表形式で表示される | UI |

---

## 6. 実行手順（例：T-001）
1. ブラウザで `http://127.0.0.1:5000/` を開く  
2. 入力フォームに以下を入力  
   - weight: 60  
   - body_fat: 20  
   - goal: 15  
3. 「送信」ボタンを押下  
4. AIプランが生成され、result.html に表示されることを確認  
5. SQLite DB (`fitness_assistant.db`) を `DB Browser for SQLite` で開き、users / plans テーブルにデータが保存されていることを確認  

---

## 7. 判定基準
- 期待結果と実際の動作が一致すれば「合格」  
- 想定外のエラーや処理が行われた場合は「不合格」  

---

## 8. 備考
- 履歴表示は新しい順で最大5件まで  
- Ollama APIは環境に依存するため、ネットワークやモデル未起動時のエラーテストも含む  
